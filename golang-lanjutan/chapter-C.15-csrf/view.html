<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form action="/sayHello" method="post" id="form">
      <div>
        <label for="">Name</label>
        <input type="text" name="name" placeholder="type yout name here" />
      </div>
      <div>
        <label for="">Gender</label>
        <select name="gender" id="">
          <option value="">Select One</option>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </div>
      <div>
        <input type="hidden" name="csrf" value="{{.csrf}}" />
        <button type="submit">Submit</button>
      </div>
    </form>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
      $(function () {
        $("#form").on("submit", function (e) {
          e.preventDefault();
          var self = $(this);
          var formData = {
            name: self.find('[name="name"]').val(),
            gender: self.find('[name="gender"]').val(),
          };

          var url = self.attr("action");
          var method = self.attr("method");
          var payload = JSON.stringify(formData);

          $.ajax({
            url: url,
            type: method,
            contentType: "application/json",
            data: payload,
            beforeSend: function (req) {
              var csrfToken = self.find('[name="csrf"]').val();
              req.setRequestHeader("X-CSRF-Token", csrfToken);
            },
          })
            .then(function (res) {
              alert(res);
            })
            .catch(function (err) {
              alert("Error: " + err.responseText);
              console.error(err);
            });
        });
      });
    </script>
  </body>
</html>
